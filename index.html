<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>iwillnotblunder</title>
    <link rel="stylesheet" href="https://unpkg.com/@lichess-org/chessground/assets/chessground.base.css" />
    <link rel="stylesheet" href="https://unpkg.com/@lichess-org/chessground/assets/chessground.brown.css" />
    <link rel="stylesheet" href="https://unpkg.com/@lichess-org/chessground/assets/chessground.cburnett.css" />
    <style>
      :root {
        --bg: #0b0f17;
        --surface: #121826;
        --surface-2: #0f1523;
        --text: #e6ecff;
        --muted: #93a1b5;
        --primary: #4f8cff;
        --primary-600: #3a70d9;
        --ring: rgba(79, 140, 255, 0.5);
        --border: #1f2937;
        --badge: #1b2333;
      }
      * { box-sizing: border-box; }
      body { 
        font-family: ui-sans-serif, system-ui, -apple-system; 
        margin: 0; 
        padding: 16px; 
        background: var(--bg); 
        color: var(--text); 
        min-height: 100vh;
      }
      
      /* 移动端优化 */
      @media (max-width: 768px) {
        body { padding: 12px; }
      }
      
      .topbar { 
        display:flex; 
        align-items:center; 
        justify-content: space-between; 
        margin-bottom: 16px; 
        flex-wrap: wrap;
        gap: 12px;
      }
      .brand { font-weight: 700; letter-spacing: 0.3px; }
      .lang-switch { display:flex; gap:8px; }
      .lang-switch button { 
        padding: 6px 10px; 
        border:1px solid var(--border); 
        background: var(--surface-2); 
        color: var(--text); 
        border-radius: 8px; 
        cursor: pointer; 
        min-width: 44px; /* 触摸友好 */
      }
      .lang-switch button.active { border-color: var(--primary); outline: 2px solid var(--ring); }

      .container { 
        display: grid; 
        grid-template-columns: 520px 1fr; 
        gap: 24px; 
        max-width: 1200px;
        margin: 0 auto;
      }
      
      /* 移动端响应式布局 */
      @media (max-width: 1024px) {
        .container { 
          grid-template-columns: 1fr; 
          gap: 16px; 
        }
      }
      
      @media (max-width: 768px) {
        .container { 
          gap: 12px; 
        }
      }
      
      .card { 
        background: var(--surface); 
        border: 1px solid var(--border); 
        border-radius: 14px; 
        box-shadow: 0 6px 20px rgba(0,0,0,0.35); 
        position: relative; 
      }
      .board-wrap { 
        position: relative; 
        width: 500px; 
        height: 500px; 
        padding: 0; 
        margin: 0 auto;
      }
      
      /* 移动端棋盘自适应 */
      @media (max-width: 768px) {
        .board-wrap { 
          width: 100%; 
          max-width: 400px; 
          height: auto; 
          aspect-ratio: 1;
        }
      }
      
      @media (max-width: 480px) {
        .board-wrap { 
          max-width: 320px; 
        }
      }
      
      /* 让棋盘卡片与棋盘内容同一定位上下文，阴影不影响内部测量 */
      .grid.card { padding: 10px; }
      .grid.card, .panel.card { overflow: visible; }
      .board { 
        width: 100%; 
        height: 100%; 
        position: relative; 
        border-radius: 10px; 
        overflow: hidden; 
      }
      .panel { 
        padding: 16px; 
        display: flex; 
        flex-direction: column; 
        gap: 12px; 
      }
      
      @media (max-width: 768px) {
        .panel { 
          padding: 12px; 
          gap: 12px; 
        }
      }
      
      .badges { 
        display: flex; 
        gap: 8px; 
        flex-wrap: wrap; 
      }
      .badge { 
        background: var(--badge); 
        border:1px solid var(--border); 
        border-radius: 8px; 
        padding: 4px 8px; 
        font-size: 12px; 
        color: var(--muted); 
      }
      .legend { 
        font-size: 12px; 
        color: var(--muted); 
      }
      .row { 
        display:flex; 
        gap:8px; 
        align-items:center; 
        flex-wrap: wrap; 
      }
      
      @media (max-width: 768px) {
        .row { 
          gap: 6px; 
        }
      }
      
      textarea { 
        width: 100%; 
        height: 84px; 
        font-family: ui-monospace, SFMono-Regular, Menlo, monospace; 
        background: var(--surface-2); 
        color: var(--text); 
        border:1px solid var(--border); 
        border-radius: 10px; 
        padding: 10px; 
        resize: vertical;
        min-height: 60px;
      }
      
      @media (max-width: 768px) {
        textarea { 
          height: 60px; 
          min-height: 50px;
          font-size: 14px;
        }
      }
      
      button { 
        padding: 10px 12px; 
        border-radius: 10px; 
        border: 1px solid var(--border); 
        background: var(--surface-2); 
        color: var(--text); 
        cursor: pointer; 
        transition: border-color .15s ease, transform .05s ease; 
        font-size: 14px;
        min-height: 44px; /* 触摸友好 */
        white-space: nowrap;
      }
      
      @media (max-width: 768px) {
        button { 
          padding: 10px 8px; 
          font-size: 13px; 
          min-height: 44px;
        }
      }
      
      button:hover { border-color: var(--primary); }
      button:active { transform: translateY(1px); }
      .btn-primary { 
        background: linear-gradient(180deg, var(--primary), var(--primary-600)); 
        border-color: var(--primary-600); 
        color: white; 
      }
      .btn-outline { background: transparent; }
      .square-overlay { 
        position:absolute; 
        left:0; 
        top:0; 
        width:100%; 
        height:100%; 
        pointer-events:none; 
        z-index: 1000; 
        box-sizing: border-box; 
      }
      .probe-cell { 
        position:absolute; 
        width:12.5%; 
        height:12.5%; 
        opacity:0; 
        pointer-events:none; 
      }
      .board .cg-wrap { position: absolute !important; inset: 0 !important; }
      /* 消除主题在容器与棋盘上的边框/内边距，确保覆盖层与棋盘同一参考系 */
      .board .cg-wrap { border: 0 !important; padding: 0 !important; margin: 0 !important; box-sizing: border-box; }
      .board .cg-board { position: absolute !important; inset: 0 !important; width: 100% !important; height: 100% !important; border: 0 !important; padding: 0 !important; margin: 0 !important; box-sizing: border-box; }
      /* 确保 cg-container 是定位上下文，使 overlay 绝对定位贴合其实际 496×496 尺寸 */
      .board cg-container { display: block; position: relative !important; width: 100% !important; height: 100% !important; border: 0 !important; padding: 0 !important; margin: 0 !important; box-sizing: border-box; }
      .overlay-cell { position:absolute; box-sizing:border-box; }
      .heat { background: rgba(255,0,0,var(--alpha)); }
      .heat-blue { background: rgba(0,120,255,var(--alpha)); }
      .grid { position:relative; }
      .square-overlay { transform: translateZ(0); }
      
      /* 移动端按钮组优化 */
      @media (max-width: 768px) {
        .row {
          display: grid;
          grid-template-columns: repeat(2, 1fr);
          gap: 8px;
        }
        
        .row button {
          width: 100%;
          text-align: center;
          white-space: normal;
          word-break: break-word;
          line-height: 1.2;
          padding: 10px 6px;
        }
        
        /* 主要按钮独占一行 */
        .btn-primary {
          grid-column: 1 / -1;
        }
        
        /* 切换按钮独占一行 */
        #btn-switch-side {
          grid-column: 1 / -1;
        }
      }
      
      /* 超小屏幕按钮优化 */
      @media (max-width: 480px) {
        .row {
          grid-template-columns: 1fr;
          gap: 6px;
        }
        
        .row button {
          padding: 8px 4px;
          font-size: 12px;
        }
      }
      
      /* 移动端徽章优化 */
      @media (max-width: 768px) {
        .badge {
          font-size: 11px;
          padding: 3px 6px;
        }
      }
      
      /* 移动端语言切换优化 */
      @media (max-width: 480px) {
        .topbar {
          flex-direction: column;
          align-items: stretch;
        }
        
        .lang-switch {
          justify-content: center;
        }
      }
      
      /* 移动端额外优化 */
      @media (max-width: 768px) {
        /* 确保棋盘在移动端有足够的触摸区域 */
        .board .cg-wrap {
          touch-action: manipulation;
        }
        
        /* 确保文本在小屏幕上可读 */
        .legend {
          font-size: 11px;
          line-height: 1.4;
        }
        
        /* 优化徽章显示 */
        .badges {
          gap: 6px;
        }
        
        .badge {
          font-size: 10px;
          padding: 3px 6px;
          line-height: 1.3;
        }
      }
      
      /* 超小屏幕优化 */
      @media (max-width: 360px) {
        body {
          padding: 8px;
        }
        
        .board-wrap {
          max-width: 280px;
        }
        
        .row button {
          font-size: 12px;
          padding: 6px 8px;
        }
      }
    </style>
  </head>
  <body>
    <div class="topbar">
      <div class="brand">iwillnotblunder</div>
      <div class="lang-switch">
        <button id="lang-en" class="active" data-i18n="lang.en">EN</button>
        <button id="lang-zh" data-i18n="lang.zh">中文</button>
      </div>
    </div>
    <div class="container">
      <div class="grid card">
        <div class="board-wrap">
          <div id="board" class="board brown"></div>
          <div id="overlay" class="square-overlay"></div>
        </div>
      </div>
      <div class="panel card">
        <div class="row">
          <button id="btn-apply-fen" class="btn-primary" data-i18n="btn.applyFen">Apply FEN</button>
          <button id="btn-reset" data-i18n="btn.reset">Start position</button>
          <button id="btn-switch-side" data-i18n="btn.switchSide">Switch my side (White/Black)</button>
        </div>
        <div class="row">
          <button id="btn-opponent" data-i18n="btn.opp">Opponent only (O)</button>
          <button id="btn-mine" data-i18n="btn.mine">Mine only (M)</button>
          <button id="btn-clear" data-i18n="btn.clear">Hide (H)</button>
          <button id="btn-login-lichess" class="btn-outline" data-i18n="btn.login">Login with Lichess</button>
        </div>
        <textarea id="fen"></textarea>
        <div class="badges">
          <span class="badge" data-i18n="badge.shortcuts">Hotkeys: O opponent / M mine / H hide</span>
          <span class="badge" data-i18n="badge.drag">Drag or click to move; overlay updates in real time</span>
        </div>
        <div class="legend" data-i18n="legend">Red: opponent control; Blue: my control. Opacity scales linearly with count.</div>
      </div>
    </div>

    <!-- 开发：Vite 会处理 /src/main.ts；生产：同样可用 Vite 构建输出 -->
    <script type="module" src="/src/main.ts"></script>
    
  </body>
  </html>


